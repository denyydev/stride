# Конституция проекта Step Pulse

## Архитектурные правила

### Структура проекта

```
src/
  app/              # Expo Router файлы (file-based routing)
    (tabs)/         # Tab навигация
    providers/      # Провайдеры (Theme, Store и т.д.)
    theme/          # Токены темы (colors, spacing, typography)
    store/          # Zustand stores
  
  shared/           # Переиспользуемый код
    ui/             # UI компоненты (Text, Card, и т.д.)
    lib/            # Утилиты (storage, helpers)
  
  screens/          # Тонкие обёртки экранов (логика в shared/app)
```

### Принципы

1. **Тонкие экраны (Thin Screens)**
   - Экранные компоненты — только UI и навигация
   - Вся бизнес-логика в `app/store/` или `shared/lib/`
   - Максимум 100-150 строк на экран

2. **Разделение ответственности**
   - UI компоненты в `shared/ui/` — без бизнес-логики
   - Store в `app/store/` — состояние приложения
   - Утилиты в `shared/lib/` — чистые функции

3. **Импорты**
   - Абсолютные импорты через `@/` (настроено в tsconfig)
   - Избегать циклических зависимостей
   - `shared/` не импортирует из `screens/` или `app/`

4. **Типизация**
   - Строгий TypeScript (strict mode)
   - Все компоненты типизированы
   - Публичные API с явными типами

## Правила производительности (Performance Rules)

### Рендеринг

1. **Мемоизация**
   - Использовать `React.memo` для компонентов, которые рендерятся часто
   - `useMemo` для тяжёлых вычислений
   - `useCallback` для функций, передаваемых в дочерние компоненты

2. **Анимации**
   - Использовать `react-native-reanimated` для всех анимаций
   - Избегать `Animated` API для сложных анимаций
   - Анимации на UI thread (worklets)

3. **Списки**
   - `FlashList` для длинных списков (будущее)
   - Правильный `keyExtractor`
   - Оптимальный `estimatedItemSize`

4. **Изображения**
   - Использовать `expo-image` вместо `Image`
   - Оптимизация размеров
   - Lazy loading где возможно

### State Management

1. **Zustand**
   - Небольшие, сфокусированные stores
   - Избегать глубокой вложенности состояния
   - Селекторы для доступа к части состояния

2. **Storage**
   - AsyncStorage только для критических данных (onboarding, настройки)
   - Избегать частых записей
   - Дебаунс для автосохранения

## Definition of Done (DoD) для экранов

Экран считается готовым, если:

1. ✅ **Функциональность**
   - Все требования реализованы
   - Обработка ошибок (если применимо)
   - Loading состояния

2. ✅ **Навигация**
   - Корректная интеграция с Expo Router
   - Правильные переходы между экранами
   - Back button обработка (Android)

3. ✅ **UI/UX**
   - Поддержка light/dark темы
   - Адаптация под SafeArea
   - Поддержка разных размеров экранов
   - Haptic feedback где уместно

4. ✅ **Производительность**
   - Нет видимых лагов (60 FPS)
   - Оптимизированы ре-рендеры
   - Плавные анимации

5. ✅ **Код**
   - TypeScript без ошибок
   - Компоненты типизированы
   - Нет циклических импортов
   - Код ревью пройден

6. ✅ **Тестирование**
   - Проверено на iPhone (Expo Go)
   - Проверено на Android Emulator
   - Основные сценарии работают

## Стайл-гайд

### Именование

- Компоненты: `PascalCase` (например, `HomeScreen.tsx`)
- Утилиты: `camelCase` (например, `storage.ts`)
- Константы: `UPPER_SNAKE_CASE` (например, `STORAGE_KEYS`)

### Экспорты

- Один компонент на файл
- Именованные экспорты для утилит
- `export default` только для компонентов

### Комментарии

- Комментарии только для сложной логики
- JSDoc для публичных API
- Избегать очевидных комментариев

## Будущие улучшения (не сейчас)

- `react-native-reanimated` (уже установлен, структура готова)
- `FlashList` (структура готова)
- Deep linking
- Analytics
- Crash reporting

